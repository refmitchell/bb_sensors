<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>bb_sensors: pol_op_mux.cpp File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
<script type="text/javascript" src="jquery.js"></script>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">pol_op_mux.cpp File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>ROS node to read from the full eight-unit polarisation sensor.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;linux/i2c-dev.h&gt;</code><br />
<code>#include &lt;linux/ioctl.h&gt;</code><br />
<code>#include &lt;fcntl.h&gt;</code><br />
<code>#include &lt;unistd.h&gt;</code><br />
<code>#include &lt;iostream&gt;</code><br />
<code>#include &lt;chrono&gt;</code><br />
<code>#include &lt;thread&gt;</code><br />
<code>#include &lt;sstream&gt;</code><br />
<code>#include &quot;<a class="el" href="ADS122C04__ADC__PI_8hpp_source.html">bb_sensors/ADS122C04_ADC_PI.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="POL__OP_8hpp_source.html">bb_sensors/POL_OP.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="argparse_8h_source.html">bb_sensors/argparse.h</a>&quot;</code><br />
<code>#include &quot;ros/ros.h&quot;</code><br />
<code>#include &quot;std_msgs/Int32MultiArray.h&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for pol_op_mux.cpp:</div>
<div class="dyncontent">
<div class="center"><img src="pol__op__mux_8cpp__incl.png" border="0" usemap="#pol__op__mux_8cpp" alt=""/></div>
<map name="pol__op__mux_8cpp" id="pol__op__mux_8cpp">
<area shape="rect" title="ROS node to read from the full eight&#45;unit polarisation sensor." alt="" coords="619,5,736,32"/>
<area shape="rect" title=" " alt="" coords="5,80,109,107"/>
<area shape="rect" title=" " alt="" coords="133,80,221,107"/>
<area shape="rect" title=" " alt="" coords="245,80,304,107"/>
<area shape="rect" title=" " alt="" coords="329,80,397,107"/>
<area shape="rect" title=" " alt="" coords="597,162,669,189"/>
<area shape="rect" title=" " alt="" coords="1196,244,1257,271"/>
<area shape="rect" title=" " alt="" coords="1615,80,1673,107"/>
<area shape="rect" title=" " alt="" coords="693,162,763,189"/>
<area shape="rect" href="ADS122C04__ADC__PI_8hpp.html" title=" " alt="" coords="406,155,573,196"/>
<area shape="rect" href="POL__OP_8hpp.html" title=" " alt="" coords="421,80,589,107"/>
<area shape="rect" href="argparse_8h.html" title=" " alt="" coords="1081,80,1236,107"/>
<area shape="rect" title=" " alt="" coords="1698,80,1771,107"/>
<area shape="rect" title=" " alt="" coords="1795,80,1975,107"/>
<area shape="rect" title=" " alt="" coords="332,244,393,271"/>
<area shape="rect" title=" " alt="" coords="462,244,517,271"/>
<area shape="rect" title=" " alt="" coords="1428,162,1503,189"/>
<area shape="rect" title=" " alt="" coords="1527,162,1588,189"/>
<area shape="rect" title=" " alt="" coords="1612,162,1673,189"/>
<area shape="rect" title=" " alt="" coords="1697,162,1764,189"/>
<area shape="rect" title=" " alt="" coords="1788,162,1844,189"/>
<area shape="rect" title=" " alt="" coords="838,162,885,189"/>
<area shape="rect" title=" " alt="" coords="909,162,977,189"/>
<area shape="rect" title=" " alt="" coords="1001,162,1079,189"/>
<area shape="rect" title=" " alt="" coords="1103,162,1214,189"/>
<area shape="rect" title=" " alt="" coords="1239,162,1297,189"/>
<area shape="rect" title=" " alt="" coords="1321,162,1404,189"/>
</map>
</div>
</div>
<p><a href="pol__op__mux_8cpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a21e8afd498c81fc2d2c43088e9a45fd6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pol__op__mux_8cpp.html#a21e8afd498c81fc2d2c43088e9a45fd6">A2D_ADDR_1</a>&#160;&#160;&#160;0x40</td></tr>
<tr class="separator:a21e8afd498c81fc2d2c43088e9a45fd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43f82499175b44a2de8529bd5e87ea9a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pol__op__mux_8cpp.html#a43f82499175b44a2de8529bd5e87ea9a">A2D_ADDR_2</a>&#160;&#160;&#160;0x41</td></tr>
<tr class="separator:a43f82499175b44a2de8529bd5e87ea9a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af855c94dc540e943632089ce7496faac"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pol__op__mux_8cpp.html#af855c94dc540e943632089ce7496faac">LOG</a>(x)&#160;&#160;&#160;std::cout &lt;&lt; x &lt;&lt; std::endl</td></tr>
<tr class="separator:af855c94dc540e943632089ce7496faac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a275f687a50cfdd64445e0b0c78ed8b7c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pol__op__mux_8cpp.html#a275f687a50cfdd64445e0b0c78ed8b7c">MUX_ADDR</a>&#160;&#160;&#160;0x70</td></tr>
<tr class="separator:a275f687a50cfdd64445e0b0c78ed8b7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a872cac9b46388e148a2b6989a41f0276"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pol__op__mux_8cpp.html#a872cac9b46388e148a2b6989a41f0276">init_mux</a> (std::string bus)</td></tr>
<tr class="separator:a872cac9b46388e148a2b6989a41f0276"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56681b6a61ff0d9d953b6869269af999"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pol__op__mux_8cpp.html#a56681b6a61ff0d9d953b6869269af999">initParser</a> (<a class="el" href="classargparse_1_1ArgumentParser.html">argparse::ArgumentParser</a> &amp;<a class="el" href="pol__op__mux_8cpp.html#a17b9e3cba73f7926c4f2b56ea35ca1bc">parser</a>, int argc, char **argv)</td></tr>
<tr class="memdesc:a56681b6a61ff0d9d953b6869269af999"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialise the argument parser.  <a href="pol__op__mux_8cpp.html#a56681b6a61ff0d9d953b6869269af999">More...</a><br /></td></tr>
<tr class="separator:a56681b6a61ff0d9d953b6869269af999"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pol__op__mux_8cpp.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
<tr class="separator:a3c04138a5bfe5d72780bb7e82a18e627"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52ab94c8d15c9918daba5f971f13af3d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pol__op__mux_8cpp.html#a52ab94c8d15c9918daba5f971f13af3d">select_channel</a> (const uint8_t channel, const int fd)</td></tr>
<tr class="separator:a52ab94c8d15c9918daba5f971f13af3d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a17b9e3cba73f7926c4f2b56ea35ca1bc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classargparse_1_1ArgumentParser.html">argparse::ArgumentParser</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pol__op__mux_8cpp.html#a17b9e3cba73f7926c4f2b56ea35ca1bc">parser</a> (&quot;Parser&quot;)</td></tr>
<tr class="separator:a17b9e3cba73f7926c4f2b56ea35ca1bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>ROS node to read from the full eight-unit polarisation sensor. </p>
<p>This node allows the robot to read from the polarisation array constructed for Gkanias et al. (2023). Each polarisation opponent unit is read in sequence using the same multiplexer (TCA9548A) as in the wind sensing node (<a class="el" href="i2c__mux_8cpp.html" title="ROS node which reads from a custom wind sensor.">i2c_mux.cpp</a>).</p>
<dl class="section note"><dt>Note</dt><dd>Each polarisation opponent unit is uses two I2C analogue to digital converters (ADCs). The four photodiodes are split across the two ADCs, meaning we need to read from both to read from all four photodiodes. Hence, two I2C addresses for one unit.</dd></dl>
<dl class="section author"><dt>Author</dt><dd>Robert Mitchell </dd></dl>

<p class="definition">Definition in file <a class="el" href="pol__op__mux_8cpp_source.html">pol_op_mux.cpp</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a21e8afd498c81fc2d2c43088e9a45fd6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a21e8afd498c81fc2d2c43088e9a45fd6">&#9670;&nbsp;</a></span>A2D_ADDR_1</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define A2D_ADDR_1&#160;&#160;&#160;0x40</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>1st ADC address </p>

<p class="definition">Definition at line <a class="el" href="pol__op__mux_8cpp_source.html#l00040">40</a> of file <a class="el" href="pol__op__mux_8cpp_source.html">pol_op_mux.cpp</a>.</p>

</div>
</div>
<a id="a43f82499175b44a2de8529bd5e87ea9a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43f82499175b44a2de8529bd5e87ea9a">&#9670;&nbsp;</a></span>A2D_ADDR_2</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define A2D_ADDR_2&#160;&#160;&#160;0x41</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>2nd ADC address </p>

<p class="definition">Definition at line <a class="el" href="pol__op__mux_8cpp_source.html#l00041">41</a> of file <a class="el" href="pol__op__mux_8cpp_source.html">pol_op_mux.cpp</a>.</p>

</div>
</div>
<a id="af855c94dc540e943632089ce7496faac"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af855c94dc540e943632089ce7496faac">&#9670;&nbsp;</a></span>LOG</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define LOG</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">x</td><td>)</td>
          <td>&#160;&#160;&#160;std::cout &lt;&lt; x &lt;&lt; std::endl</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="pol__op__mux_8cpp_source.html#l00037">37</a> of file <a class="el" href="pol__op__mux_8cpp_source.html">pol_op_mux.cpp</a>.</p>

</div>
</div>
<a id="a275f687a50cfdd64445e0b0c78ed8b7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a275f687a50cfdd64445e0b0c78ed8b7c">&#9670;&nbsp;</a></span>MUX_ADDR</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MUX_ADDR&#160;&#160;&#160;0x70</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Multiplexer I2C address </p>

<p class="definition">Definition at line <a class="el" href="pol__op__mux_8cpp_source.html#l00039">39</a> of file <a class="el" href="pol__op__mux_8cpp_source.html">pol_op_mux.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a872cac9b46388e148a2b6989a41f0276"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a872cac9b46388e148a2b6989a41f0276">&#9670;&nbsp;</a></span>init_mux()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_mux </td>
          <td>(</td>
          <td class="paramtype">std::string&#160;</td>
          <td class="paramname"><em>bus</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialises the multiplexer on the I2C bus. If the initialisation fails then the node will shut down.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">bus</td><td>The string identifier for the I2C bus, see Linux kernel documentation. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A file descriptor which can be used to access the multiplexer. </dd></dl>

<p class="definition">Definition at line <a class="el" href="pol__op__mux_8cpp_source.html#l00092">92</a> of file <a class="el" href="pol__op__mux_8cpp_source.html">pol_op_mux.cpp</a>.</p>

</div>
</div>
<a id="a56681b6a61ff0d9d953b6869269af999"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56681b6a61ff0d9d953b6869269af999">&#9670;&nbsp;</a></span>initParser()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool initParser </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classargparse_1_1ArgumentParser.html">argparse::ArgumentParser</a> &amp;&#160;</td>
          <td class="paramname"><em>parser</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialise the argument parser. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">parser</td><td>The parser object. </td></tr>
    <tr><td class="paramname">parser</td><td>argc Passthrough argc from main. </td></tr>
    <tr><td class="paramname">parser</td><td>argv Passthrough argv from main. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><code>true</code> on successful initialisation, otherwise <code>false</code> </dd></dl>

<p class="definition">Definition at line <a class="el" href="pol__op__mux_8cpp_source.html#l00052">52</a> of file <a class="el" href="pol__op__mux_8cpp_source.html">pol_op_mux.cpp</a>.</p>

</div>
</div>
<a id="a3c04138a5bfe5d72780bb7e82a18e627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3c04138a5bfe5d72780bb7e82a18e627">&#9670;&nbsp;</a></span>main()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&#160;</td>
          <td class="paramname"><em>argv</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Main loop. </p>

<p class="definition">Definition at line <a class="el" href="pol__op__mux_8cpp_source.html#l00126">126</a> of file <a class="el" href="pol__op__mux_8cpp_source.html">pol_op_mux.cpp</a>.</p>

</div>
</div>
<a id="a52ab94c8d15c9918daba5f971f13af3d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52ab94c8d15c9918daba5f971f13af3d">&#9670;&nbsp;</a></span>select_channel()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool select_channel </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>channel</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int&#160;</td>
          <td class="paramname"><em>fd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Selects a given channel on the multiplexer and delays to allow time for channel selection to take place.</p>
<p>Will print a message to stdout if the channel selection fails.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">channel</td><td>The channel (0 - 7) to read from. </td></tr>
    <tr><td class="paramname">fd</td><td>The file descriptor used to communicate with the mux on the I2C bus. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd>This function does not return any value despite its return type. </dd></dl>

<p class="definition">Definition at line <a class="el" href="pol__op__mux_8cpp_source.html#l00116">116</a> of file <a class="el" href="pol__op__mux_8cpp_source.html">pol_op_mux.cpp</a>.</p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a17b9e3cba73f7926c4f2b56ea35ca1bc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17b9e3cba73f7926c4f2b56ea35ca1bc">&#9670;&nbsp;</a></span>parser</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classargparse_1_1ArgumentParser.html">argparse::ArgumentParser</a> parser(&quot;Parser&quot;)</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
</div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/bb_sensors">bb_sensors</a><br />
Author(s): </br />
<small>autogenerated on Thu Aug 10 2023 16:56:57</small>
</div>
</body>
</html>
